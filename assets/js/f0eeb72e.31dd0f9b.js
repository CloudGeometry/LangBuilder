"use strict";(self.webpackChunklangbuilder_docs=self.webpackChunklangbuilder_docs||[]).push([[9897],{11470:(e,n,o)=>{o.d(n,{A:()=>D});var t=o(96540),r=o(18215),s=o(23104),l=o(56347),i=o(205),a=o(57485),c=o(31682),d=o(70679);function p(e){return t.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,t.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function u(e){const{values:n,children:o}=e;return(0,t.useMemo)(()=>{const e=n??function(e){return p(e).map(({props:{value:e,label:n,attributes:o,default:t}})=>({value:e,label:n,attributes:o,default:t}))}(o);return function(e){const n=(0,c.XI)(e,(e,n)=>e.value===n.value);if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[n,o])}function h({value:e,tabValues:n}){return n.some(n=>n.value===e)}function g({queryString:e=!1,groupId:n}){const o=(0,l.W6)(),r=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,a.aZ)(r),(0,t.useCallback)(e=>{if(!r)return;const n=new URLSearchParams(o.location.search);n.set(r,e),o.replace({...o.location,search:n.toString()})},[r,o])]}function m(e){const{defaultValue:n,queryString:o=!1,groupId:r}=e,s=u(e),[l,a]=(0,t.useState)(()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!h({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const o=n.find(e=>e.default)??n[0];if(!o)throw new Error("Unexpected error: 0 tabValues");return o.value}({defaultValue:n,tabValues:s})),[c,p]=g({queryString:o,groupId:r}),[m,b]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[o,r]=(0,d.Dv)(n);return[o,(0,t.useCallback)(e=>{n&&r.set(e)},[n,r])]}({groupId:r}),y=(()=>{const e=c??m;return h({value:e,tabValues:s})?e:null})();(0,i.A)(()=>{y&&a(y)},[y]);return{selectedValue:l,selectValue:(0,t.useCallback)(e=>{if(!h({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);a(e),p(e),b(e)},[p,b,s]),tabValues:s}}var b=o(92303);const y={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var f=o(74848);function x({className:e,block:n,selectedValue:o,selectValue:t,tabValues:l}){const i=[],{blockElementScrollPositionUntilNextRender:a}=(0,s.a_)(),c=e=>{const n=e.currentTarget,r=i.indexOf(n),s=l[r].value;s!==o&&(a(n),t(s))},d=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const o=i.indexOf(e.currentTarget)+1;n=i[o]??i[0];break}case"ArrowLeft":{const o=i.indexOf(e.currentTarget)-1;n=i[o]??i[i.length-1];break}}n?.focus()};return(0,f.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":n},e),children:l.map(({value:e,label:n,attributes:t})=>(0,f.jsx)("li",{role:"tab",tabIndex:o===e?0:-1,"aria-selected":o===e,ref:e=>{i.push(e)},onKeyDown:d,onClick:c,...t,className:(0,r.A)("tabs__item",y.tabItem,t?.className,{"tabs__item--active":o===e}),children:n??e},e))})}function j({lazy:e,children:n,selectedValue:o}){const s=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=s.find(e=>e.props.value===o);return e?(0,t.cloneElement)(e,{className:(0,r.A)("margin-top--md",e.props.className)}):null}return(0,f.jsx)("div",{className:"margin-top--md",children:s.map((e,n)=>(0,t.cloneElement)(e,{key:n,hidden:e.props.value!==o}))})}function v(e){const n=m(e);return(0,f.jsxs)("div",{className:(0,r.A)("tabs-container",y.tabList),children:[(0,f.jsx)(x,{...n,...e}),(0,f.jsx)(j,{...n,...e})]})}function D(e){const n=(0,b.A)();return(0,f.jsx)(v,{...e,children:p(e.children)},String(n))}},19365:(e,n,o)=>{o.d(n,{A:()=>l});o(96540);var t=o(18215);const r={tabItem:"tabItem_Ymn6"};var s=o(74848);function l({children:e,hidden:n,className:o}){return(0,s.jsx)("div",{role:"tabpanel",className:(0,t.A)(r.tabItem,o),hidden:n,children:e})}},28453:(e,n,o)=>{o.d(n,{R:()=>l,x:()=>i});var t=o(96540);const r={},s=t.createContext(r);function l(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),t.createElement(s.Provider,{value:n},e.children)}},61227:(e,n,o)=>{o.r(n),o.d(n,{CH:()=>u,assets:()=>p,chCodeConfig:()=>h,contentTitle:()=>d,default:()=>b,frontMatter:()=>c,metadata:()=>t,toc:()=>g});const t=JSON.parse('{"id":"Develop/enterprise-database-guide","title":"Langbuilder database guide for enterprise DBAs","description":"The Langbuilder database stores data that is essential for more Langbuilder operations, including startup, flow execution, user interactions, and administrative tasks.","source":"@site/docs/Develop/enterprise-database-guide.mdx","sourceDirName":"Develop","slug":"/enterprise-database-guide","permalink":"/enterprise-database-guide","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Langbuilder database guide for enterprise DBAs","slug":"/enterprise-database-guide"},"sidebar":"docs","previous":{"title":"Configure an external PostgreSQL database","permalink":"/configuration-custom-database"},"next":{"title":"Logs","permalink":"/logging"}}');var r=o(74848),s=o(28453),l=o(24754),i=o(11470),a=o(19365);const c={title:"Langbuilder database guide for enterprise DBAs",slug:"/enterprise-database-guide"},d=void 0,p={},u={annotations:l.hk,Code:l.Cy},h={staticMediaQuery:"not screen, (max-width: 768px)",lineNumbers:!0,showCopyButton:!0,themeName:"github-dark"},g=[{value:"Configure Langbuilder with PostgreSQL",id:"configure-langbuilder-with-postgresql",level:2},{value:"High Availability for PostgreSQL",id:"high-availability-for-postgresql",level:3},{value:"Impact of database failure",id:"impact-of-database-failure",level:2},{value:"Database monitoring",id:"database-monitoring",level:2},{value:"See also",id:"see-also",level:2}];function m(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return u||y("CH",!1),u.Code||y("CH.Code",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("style",{dangerouslySetInnerHTML:{__html:'[data-ch-theme="github-dark"] {  --ch-t-colorScheme: dark;--ch-t-foreground: #c9d1d9;--ch-t-background: #0d1117;--ch-t-lighter-inlineBackground: #0d1117e6;--ch-t-editor-background: #0d1117;--ch-t-editor-foreground: #c9d1d9;--ch-t-editor-lineHighlightBackground: #6e76811a;--ch-t-editor-rangeHighlightBackground: #ffffff0b;--ch-t-editor-infoForeground: #3794FF;--ch-t-editor-selectionBackground: #264F78;--ch-t-focusBorder: #1f6feb;--ch-t-tab-activeBackground: #0d1117;--ch-t-tab-activeForeground: #c9d1d9;--ch-t-tab-inactiveBackground: #010409;--ch-t-tab-inactiveForeground: #8b949e;--ch-t-tab-border: #30363d;--ch-t-tab-activeBorder: #0d1117;--ch-t-editorGroup-border: #30363d;--ch-t-editorGroupHeader-tabsBackground: #010409;--ch-t-editorLineNumber-foreground: #6e7681;--ch-t-input-background: #0d1117;--ch-t-input-foreground: #c9d1d9;--ch-t-input-border: #30363d;--ch-t-icon-foreground: #8b949e;--ch-t-sideBar-background: #010409;--ch-t-sideBar-foreground: #c9d1d9;--ch-t-sideBar-border: #30363d;--ch-t-list-activeSelectionBackground: #6e768166;--ch-t-list-activeSelectionForeground: #c9d1d9;--ch-t-list-hoverBackground: #6e76811a;--ch-t-list-hoverForeground: #c9d1d9; }'}}),"\n","\n",(0,r.jsxs)(n.p,{children:["The Langbuilder database stores data that is essential for more Langbuilder operations, including startup, flow execution, user interactions, and administrative tasks.\nThe database supports both frontend (visual editor) and backend (API) operations, making its availability critical to Langbuilder's stability and functionality.\nFor details about the database schema, see ",(0,r.jsx)(n.a,{href:"/memory",children:"Memory management options"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"This guide is designed for enterprise database administrators (DBAs) and operators responsible for deploying and managing Langbuilder in production environments.\nIt explains how to configure Langbuilder to use PostgreSQL, including high availability (HA) and active-active configurations, as well as best practices for monitoring, maintenance, and security."}),"\n",(0,r.jsx)(n.h2,{id:"configure-langbuilder-with-postgresql",children:"Configure Langbuilder with PostgreSQL"}),"\n",(0,r.jsx)(n.p,{children:"Langbuilder's default database is SQLite.\nHowever, PostgreSQL is recommended for production deployments due to its scalability, performance, and robustness."}),"\n",(0,r.jsxs)(n.p,{children:["The following steps explain how to configure Langbuilder to use PostgreSQL for a standalone or containerized deployment.\nFor more information, see ",(0,r.jsx)(n.a,{href:"/configuration-custom-database",children:"Configure an external PostgreSQL database"}),"."]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Set up PostgreSQL:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Deploy a PostgreSQL instance (version 12 or higher recommended) using a local server, Docker, or a managed cloud service."}),"\n",(0,r.jsx)(n.li,{children:"Create a database for Langbuilder."}),"\n",(0,r.jsx)(n.li,{children:"Create a PostgreSQL user with appropriate, minimal permissions to manage and write to the database, such as CREATE, SELECT, INSERT, UPDATE, DELETE on your Langbuilder tables."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Obtain the connection string in the format ",(0,r.jsx)(n.code,{children:"postgresql://user:password@host:port/dbname"}),", such as",(0,r.jsx)(n.code,{children:"postgresql://langbuilder:securepassword@postgres:5432/langbuilder"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["For High Availability, use the virtual IP or proxy hostname instead of the direct database host.\nFor more information, see ",(0,r.jsx)(n.a,{href:"#high-availability-for-postgresql",children:"High Availability for PostgreSQL"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Configure Langbuilder with the ",(0,r.jsx)(n.code,{children:".env"})," or ",(0,r.jsx)(n.code,{children:"docker-compose.yml"})," files."]}),"\n",(0,r.jsxs)(i.A,{groupId:"environment",children:[(0,r.jsxs)(a.A,{value:".env",label:".env",default:!0,children:[(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Create a ",(0,r.jsx)(n.code,{children:".env"})," file in the ",(0,r.jsx)(n.code,{children:"langbuilder"})," directory:"]}),"\n",(0,r.jsx)(u.Code,{codeConfig:h,northPanel:{tabs:[""],active:"",heightRatio:1},files:[{name:"",focus:"",code:{lines:[{tokens:[{content:"touch ",props:{style:{color:"#FFA657"}}},{content:".env",props:{style:{color:"#A5D6FF"}}}]}],lang:"shell"},annotations:[]}]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Add the connection string to the ",(0,r.jsx)(n.code,{children:".env"})," file:"]}),"\n",(0,r.jsx)(u.Code,{codeConfig:h,northPanel:{tabs:[""],active:"",heightRatio:1},files:[{name:"",focus:"",code:{lines:[{tokens:[{content:'LANGBUILDER_DATABASE_URL="postgresql://langbuilder:securepassword@postgres:5432/langbuilder"',props:{}}]}],lang:"text"},annotations:[]}]}),"\n"]}),"\n"]}),(0,r.jsxs)(n.p,{children:["For more environment variables, see the ",(0,r.jsx)(n.code,{children:".env.example"})," file in the Langbuilder repository."]})]}),(0,r.jsxs)(a.A,{value:"docker-compose.yml",label:"docker-compose.yml",children:[(0,r.jsxs)(n.p,{children:["Use the sample ",(0,r.jsx)(n.code,{children:"docker-compose.yml"})," from the Langbuilder Repository.\nYou can use the default values or customize them as needed."]}),(0,r.jsx)(u.Code,{codeConfig:h,northPanel:{tabs:[""],active:"",heightRatio:1},files:[{name:"",focus:"",code:{lines:[{tokens:[{content:"version",props:{style:{color:"#7EE787"}}},{content:": ",props:{style:{color:"#C9D1D9"}}},{content:"'3'",props:{style:{color:"#A5D6FF"}}}]},{tokens:[{content:"services",props:{style:{color:"#7EE787"}}},{content:":",props:{style:{color:"#C9D1D9"}}}]},{tokens:[{content:"  langbuilder",props:{style:{color:"#7EE787"}}},{content:":",props:{style:{color:"#C9D1D9"}}}]},{tokens:[{content:"    image",props:{style:{color:"#7EE787"}}},{content:": ",props:{style:{color:"#C9D1D9"}}},{content:"nickchasecg/langbuilder:latest",props:{style:{color:"#A5D6FF"}}}]},{tokens:[{content:"    ports",props:{style:{color:"#7EE787"}}},{content:":",props:{style:{color:"#C9D1D9"}}}]},{tokens:[{content:"      - ",props:{style:{color:"#C9D1D9"}}},{content:'"7860:7860"',props:{style:{color:"#A5D6FF"}}}]},{tokens:[{content:"    environment",props:{style:{color:"#7EE787"}}},{content:":",props:{style:{color:"#C9D1D9"}}}]},{tokens:[{content:"      - ",props:{style:{color:"#C9D1D9"}}},{content:"LANGBUILDER_DATABASE_URL=postgresql://langbuilder:langbuilder@postgres:5432/langbuilder",props:{style:{color:"#A5D6FF"}}}]},{tokens:[{content:"  postgres",props:{style:{color:"#7EE787"}}},{content:":",props:{style:{color:"#C9D1D9"}}}]},{tokens:[{content:"    image",props:{style:{color:"#7EE787"}}},{content:": ",props:{style:{color:"#C9D1D9"}}},{content:"postgres:16",props:{style:{color:"#A5D6FF"}}}]},{tokens:[{content:"    ports",props:{style:{color:"#7EE787"}}},{content:":",props:{style:{color:"#C9D1D9"}}}]},{tokens:[{content:"      - ",props:{style:{color:"#C9D1D9"}}},{content:'"5432:5432"',props:{style:{color:"#A5D6FF"}}}]},{tokens:[{content:"    environment",props:{style:{color:"#7EE787"}}},{content:":",props:{style:{color:"#C9D1D9"}}}]},{tokens:[{content:"      - ",props:{style:{color:"#C9D1D9"}}},{content:"POSTGRES_USER=langbuilder",props:{style:{color:"#A5D6FF"}}}]},{tokens:[{content:"      - ",props:{style:{color:"#C9D1D9"}}},{content:"POSTGRES_PASSWORD=langbuilder",props:{style:{color:"#A5D6FF"}}}]},{tokens:[{content:"      - ",props:{style:{color:"#C9D1D9"}}},{content:"POSTGRES_DB=langbuilder",props:{style:{color:"#A5D6FF"}}}]},{tokens:[{content:"    volumes",props:{style:{color:"#7EE787"}}},{content:":",props:{style:{color:"#C9D1D9"}}}]},{tokens:[{content:"      - ",props:{style:{color:"#C9D1D9"}}},{content:"langbuilder-postgres:/var/lib/postgresql/data",props:{style:{color:"#A5D6FF"}}}]},{tokens:[{content:"volumes",props:{style:{color:"#7EE787"}}},{content:":",props:{style:{color:"#C9D1D9"}}}]},{tokens:[{content:"  - ",props:{style:{color:"#C9D1D9"}}},{content:"langbuilder-postgres",props:{style:{color:"#7EE787"}}},{content:":",props:{style:{color:"#C9D1D9"}}}]}],lang:"yaml"},annotations:[]}]})]})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Start Langbuilder with your PostgreSQL connection:"}),"\n",(0,r.jsxs)(i.A,{groupId:"environment",children:[(0,r.jsx)(a.A,{value:".env",label:".env",default:!0,children:(0,r.jsx)(u.Code,{codeConfig:h,northPanel:{tabs:[""],active:"",heightRatio:1},files:[{name:"",focus:"",code:{lines:[{tokens:[{content:"uv ",props:{style:{color:"#FFA657"}}},{content:"run langbuilder run ",props:{style:{color:"#A5D6FF"}}},{content:"--env-file ",props:{style:{color:"#79C0FF"}}},{content:".env",props:{style:{color:"#A5D6FF"}}}]}],lang:"shell"},annotations:[]}]})}),(0,r.jsx)(a.A,{value:"docker-compose.yml",label:"docker-compose.yml",children:(0,r.jsxs)(n.p,{children:["Navigate to the directory containing ",(0,r.jsx)(n.code,{children:"docker-compose.yml"}),", and then run ",(0,r.jsx)(n.code,{children:"docker-compose up"}),"."]})})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Optional: Run migrations."}),"\n",(0,r.jsx)(n.p,{children:"Langbuilder uses migrations to manage its database schema.\nWhen you first connect to PostgreSQL, Langbuilder automatically runs migrations to create the necessary tables."}),"\n",(0,r.jsx)(n.p,{children:"Direct schema modification can cause conflicts with Langbuilder's built-in schema management.\nIf you need to update the schema, you can manually run migrations with the Langbuilder CLI:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Run ",(0,r.jsx)(n.code,{children:"langbuilder migration"})," to preview the changes."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Review the changes to ensure that it's safe to proceed with the migration."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Run ",(0,r.jsx)(n.code,{children:"langbuilder migration --fix"})," to run the migration and permanently apply the changes."]}),"\n",(0,r.jsxs)(n.p,{children:["This is a destructive operation that can delete data.\nFor more information, see ",(0,r.jsx)(n.a,{href:"/configuration-cli#langbuilder-migration",children:(0,r.jsx)(n.code,{children:"langbuilder migration"})}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"To verify the configuration, create any flow using the Langbuilder visual editor or API, and then query your database to confirm the tables and activity are recorded there. The content of the flow doesn't matter; you only need to confirm that the flow is stored in your PostgreSQL database.\nYou can query the database in two ways:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Query the database container:"}),"\n",(0,r.jsx)(u.Code,{codeConfig:h,northPanel:{tabs:[""],active:"",heightRatio:1},files:[{name:"",focus:"",code:{lines:[{tokens:[{content:"docker exec -it <postgres-container> psql -U langbuilder -d langbuilder",props:{}}]}],lang:"text"},annotations:[]}]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Use SQL:"}),"\n",(0,r.jsx)(u.Code,{codeConfig:h,northPanel:{tabs:[""],active:"",heightRatio:1},files:[{name:"",focus:"",code:{lines:[{tokens:[{content:"SELECT * FROM pg_stat_activity WHERE datname = 'langbuilder';",props:{}}]}],lang:"text"},annotations:[]}]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"high-availability-for-postgresql",children:"High Availability for PostgreSQL"}),"\n",(0,r.jsx)(n.p,{children:"To further improve performance, reliability, and scalability, use a High Availability (HA) or Active-Active HA PostgreSQL configuration.\nThis is recommended for production deployments to minimize downtime and ensure continuous operations if your database server fails, especially when multiple Langbuilder instances rely on the same database."}),"\n",(0,r.jsxs)(i.A,{children:[(0,r.jsx)(a.A,{value:"HA",label:"High Availability (HA)",default:!0,children:(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Set up streaming replication:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Configure one primary database for writes."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Configure one or more replicas for reads and failover."}),"\n",(0,r.jsx)(n.p,{children:"Select either synchronous or asynchronous replication based on your latency and consistency requirements."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Implement automatic failover using one of the following options:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Use an HA orchestrator, distributed configuration store, and traffic router, such as ",(0,r.jsx)(n.a,{href:"https://patroni.readthedocs.io/en/latest/",children:"Patroni"}),", etcd or ",(0,r.jsx)(n.a,{href:"https://developer.hashicorp.com/consul",children:"Consul"}),", and ",(0,r.jsx)(n.a,{href:"https://www.haproxy.org/",children:"HAProxy"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.a,{href:"https://www.pgpool.net/docs/46/en/html/index.html",children:"Pgpool-II"})," alone or add supporting services for more robust HA support."]}),"\n",(0,r.jsx)(n.li,{children:"Use managed services that provide built-in HA with automatic failover, such as AWS RDS or Google Cloud SQL."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Update your PostgreSQL connection string to point to the HA setup.\nIf you have a multi-instance deployment, make sure all of your Langbuilder instances connect to the same HA PostgreSQL database."}),"\n",(0,r.jsx)(n.p,{children:"The connection string you use depends on your HA configuration and services."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Use a virtual IP or DNS name that resolves to the current primary database, such as ",(0,r.jsx)(n.code,{children:"postgresql://langbuilder:securepassword@db-proxy:5432/langbuilder?sslmode=require"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Use the provided endpoint for a managed service, such as ",(0,r.jsx)(n.code,{children:"langbuilder.cluster-xyz.us-east-1.rds.amazonaws.com"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Optional: Implement load balancing for read-heavy workloads:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Use a connection pooler like ",(0,r.jsx)(n.a,{href:"https://www.pgbouncer.org/",children:"PgBouncer"})," to distribute read queries across replicas."]}),"\n",(0,r.jsx)(n.li,{children:"Configure Langbuilder to use a single connection string pointing to the primary PostgreSQL database or proxy."}),"\n"]}),"\n"]}),"\n"]})}),(0,r.jsxs)(a.A,{value:"AA",label:"Active-Active HA",children:[(0,r.jsx)(n.p,{children:"To implement Active-Active HA, you must deploy multiple Langbuilder instances, use load balancing to distribute traffic across the instances, and ensure all instances connect to the same HA PostgreSQL database:"}),(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Deploy multiple Langbuilder instances using Kubernetes or Docker Swarm."}),"\n",(0,r.jsxs)(n.p,{children:["You must configure your instances to use a shared PostgreSQL database.\nFor more information, see ",(0,r.jsx)(n.a,{href:"/deployment-prod-best-practices",children:"Best practices for Langbuilder on Kubernetes"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Set up streaming replication:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Configure one primary database for writes."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Configure one or more replicas for reads and failover."}),"\n",(0,r.jsx)(n.p,{children:"Select either synchronous or asynchronous replication based on your latency and consistency requirements."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Implement automatic failover using one of the following options:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Use an HA orchestrator, distributed configuration store, and traffic router, such as ",(0,r.jsx)(n.a,{href:"https://patroni.readthedocs.io/en/latest/",children:"Patroni"}),", etcd or ",(0,r.jsx)(n.a,{href:"https://developer.hashicorp.com/consul",children:"Consul"}),", and ",(0,r.jsx)(n.a,{href:"https://www.haproxy.org/",children:"HAProxy"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.a,{href:"https://www.pgpool.net/docs/46/en/html/index.html",children:"Pgpool-II"})," alone or add supporting services for more robust HA support."]}),"\n",(0,r.jsx)(n.li,{children:"Use managed services that provide built-in HA with automatic failover, such as AWS RDS or Google Cloud SQL."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Update your PostgreSQL connection string to point to the HA setup.\nMake sure all of your Langbuilder instances connect to the same HA PostgreSQL database."}),"\n",(0,r.jsx)(n.p,{children:"The connection string you use depends on your HA configuration and services:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Use a virtual IP or DNS name that resolves to the current primary database, such as ",(0,r.jsx)(n.code,{children:"postgresql://langbuilder:securepassword@db-proxy:5432/langbuilder?sslmode=require"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Use the provided endpoint for a managed service, such as ",(0,r.jsx)(n.code,{children:"langbuilder.cluster-xyz.us-east-1.rds.amazonaws.com"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Use a load balancer to distribute requests across your instances."}),"\n"]}),"\n"]}),(0,r.jsxs)(n.p,{children:["The following example configuration is for a production deployment that has three ",(0,r.jsx)(n.code,{children:"langbuilder-runtime"})," replicas, uses the Kubernetes load balancer service to distribute traffic to healthy pods, and uses the HA PostgreSQL database connection string."]}),(0,r.jsx)(u.Code,{codeConfig:h,northPanel:{tabs:[""],active:"",heightRatio:1},files:[{name:"",focus:"",code:{lines:[{tokens:[{content:"apiVersion",props:{style:{color:"#7EE787"}}},{content:": ",props:{style:{color:"#C9D1D9"}}},{content:"apps/v1",props:{style:{color:"#A5D6FF"}}}]},{tokens:[{content:"kind",props:{style:{color:"#7EE787"}}},{content:": ",props:{style:{color:"#C9D1D9"}}},{content:"Deployment",props:{style:{color:"#A5D6FF"}}}]},{tokens:[{content:"metadata",props:{style:{color:"#7EE787"}}},{content:":",props:{style:{color:"#C9D1D9"}}}]},{tokens:[{content:"  name",props:{style:{color:"#7EE787"}}},{content:": ",props:{style:{color:"#C9D1D9"}}},{content:"langbuilder-runtime",props:{style:{color:"#A5D6FF"}}}]},{tokens:[{content:"spec",props:{style:{color:"#7EE787"}}},{content:":",props:{style:{color:"#C9D1D9"}}}]},{tokens:[{content:"  replicas",props:{style:{color:"#7EE787"}}},{content:": ",props:{style:{color:"#C9D1D9"}}},{content:"3",props:{style:{color:"#79C0FF"}}}]},{tokens:[{content:"  selector",props:{style:{color:"#7EE787"}}},{content:":",props:{style:{color:"#C9D1D9"}}}]},{tokens:[{content:"    matchLabels",props:{style:{color:"#7EE787"}}},{content:":",props:{style:{color:"#C9D1D9"}}}]},{tokens:[{content:"      app",props:{style:{color:"#7EE787"}}},{content:": ",props:{style:{color:"#C9D1D9"}}},{content:"langbuilder-runtime",props:{style:{color:"#A5D6FF"}}}]},{tokens:[{content:"  template",props:{style:{color:"#7EE787"}}},{content:":",props:{style:{color:"#C9D1D9"}}}]},{tokens:[{content:"    metadata",props:{style:{color:"#7EE787"}}},{content:":",props:{style:{color:"#C9D1D9"}}}]},{tokens:[{content:"      labels",props:{style:{color:"#7EE787"}}},{content:":",props:{style:{color:"#C9D1D9"}}}]},{tokens:[{content:"        app",props:{style:{color:"#7EE787"}}},{content:": ",props:{style:{color:"#C9D1D9"}}},{content:"langbuilder-runtime",props:{style:{color:"#A5D6FF"}}}]},{tokens:[{content:"    spec",props:{style:{color:"#7EE787"}}},{content:":",props:{style:{color:"#C9D1D9"}}}]},{tokens:[{content:"      containers",props:{style:{color:"#7EE787"}}},{content:":",props:{style:{color:"#C9D1D9"}}}]},{tokens:[{content:"      - ",props:{style:{color:"#C9D1D9"}}},{content:"name",props:{style:{color:"#7EE787"}}},{content:": ",props:{style:{color:"#C9D1D9"}}},{content:"langbuilder",props:{style:{color:"#A5D6FF"}}}]},{tokens:[{content:"        image",props:{style:{color:"#7EE787"}}},{content:": ",props:{style:{color:"#C9D1D9"}}},{content:"nickchasecg/langbuilder:latest",props:{style:{color:"#A5D6FF"}}}]},{tokens:[{content:"        ports",props:{style:{color:"#7EE787"}}},{content:":",props:{style:{color:"#C9D1D9"}}}]},{tokens:[{content:"        - ",props:{style:{color:"#C9D1D9"}}},{content:"containerPort",props:{style:{color:"#7EE787"}}},{content:": ",props:{style:{color:"#C9D1D9"}}},{content:"7860",props:{style:{color:"#79C0FF"}}}]},{tokens:[{content:"        env",props:{style:{color:"#7EE787"}}},{content:":",props:{style:{color:"#C9D1D9"}}}]},{tokens:[{content:"        - ",props:{style:{color:"#C9D1D9"}}},{content:"name",props:{style:{color:"#7EE787"}}},{content:": ",props:{style:{color:"#C9D1D9"}}},{content:"LANGBUILDER_DATABASE_URL",props:{style:{color:"#A5D6FF"}}}]},{tokens:[{content:"          value",props:{style:{color:"#7EE787"}}},{content:": ",props:{style:{color:"#C9D1D9"}}},{content:'"postgresql://langbuilder:securepassword@db-proxy:5432/langbuilder?sslmode=require"',props:{style:{color:"#A5D6FF"}}}]},{tokens:[{content:"---",props:{style:{color:"#79C0FF"}}}]},{tokens:[{content:"apiVersion",props:{style:{color:"#7EE787"}}},{content:": ",props:{style:{color:"#C9D1D9"}}},{content:"v1",props:{style:{color:"#A5D6FF"}}}]},{tokens:[{content:"kind",props:{style:{color:"#7EE787"}}},{content:": ",props:{style:{color:"#C9D1D9"}}},{content:"Service",props:{style:{color:"#A5D6FF"}}}]},{tokens:[{content:"metadata",props:{style:{color:"#7EE787"}}},{content:":",props:{style:{color:"#C9D1D9"}}}]},{tokens:[{content:"  name",props:{style:{color:"#7EE787"}}},{content:": ",props:{style:{color:"#C9D1D9"}}},{content:"langbuilder-runtime",props:{style:{color:"#A5D6FF"}}}]},{tokens:[{content:"spec",props:{style:{color:"#7EE787"}}},{content:":",props:{style:{color:"#C9D1D9"}}}]},{tokens:[{content:"  selector",props:{style:{color:"#7EE787"}}},{content:":",props:{style:{color:"#C9D1D9"}}}]},{tokens:[{content:"    app",props:{style:{color:"#7EE787"}}},{content:": ",props:{style:{color:"#C9D1D9"}}},{content:"langbuilder-runtime",props:{style:{color:"#A5D6FF"}}}]},{tokens:[{content:"  ports",props:{style:{color:"#7EE787"}}},{content:":",props:{style:{color:"#C9D1D9"}}}]},{tokens:[{content:"  - ",props:{style:{color:"#C9D1D9"}}},{content:"port",props:{style:{color:"#7EE787"}}},{content:": ",props:{style:{color:"#C9D1D9"}}},{content:"80",props:{style:{color:"#79C0FF"}}}]},{tokens:[{content:"    targetPort",props:{style:{color:"#7EE787"}}},{content:": ",props:{style:{color:"#C9D1D9"}}},{content:"7860",props:{style:{color:"#79C0FF"}}}]},{tokens:[{content:"  type",props:{style:{color:"#7EE787"}}},{content:": ",props:{style:{color:"#C9D1D9"}}},{content:"LoadBalancer",props:{style:{color:"#A5D6FF"}}}]}],lang:"yaml"},annotations:[]}]})]})]}),"\n",(0,r.jsxs)(n.p,{children:["After implementing HA or Active-Active HA, monitor failover events and ensure replicas are in sync.\nLangbuilder, through ",(0,r.jsx)(n.a,{href:"https://docs.sqlalchemy.org/en/20/",children:"SQLAlchemy"}),", supports reconnection attempts if ",(0,r.jsx)(n.code,{children:"LANGBUILDER_DATABASE_CONNECTION_RETRY=True"}),", ensures recovery after failover, and reduces disruption once the database is back online."]}),"\n",(0,r.jsx)(n.p,{children:"Although PostgreSQL handles concurrent connections well, you must still monitor for contention, deadlocks, or other performance degradation during high load."}),"\n",(0,r.jsx)(n.h2,{id:"impact-of-database-failure",children:"Impact of database failure"}),"\n",(0,r.jsx)(n.p,{children:"If the PostgreSQL database becomes unavailable, the following Langbuilder functions will fail:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Flow Retrieval"}),": Cannot load new or existing flows from the database."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Flow Saving"}),": Unable to save new flows or updates to existing flows."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"User Authentication"}),": Login and user management functions fail."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Project Collection Access"}),": Cannot access or share community/custom project collections."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Configuration Retrieval"}),": Unable to load application settings."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Configuration Updates"}),": Changes to settings cannot be saved."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Execution Log Access"}),": Cannot retrieve historical flow execution logs."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Log Writing"}),": New execution or system activity logs cannot be recorded."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Multi-User Collaboration"}),": Sharing flows or projects across users fails."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"API Flow Loading"}),": API requests to load new flows (non-cached) fail."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Flows already loaded in memory may continue to function with cached configurations.\nHowever, any operation requiring database access fails until the database is restored.\nFor example, a cached flow might run, but it won't record logs or message history to the database."}),"\n",(0,r.jsxs)(n.p,{children:["To minimize the possibility and impact of database failure, use ",(0,r.jsx)(n.a,{href:"#high-availability-for-postgresql",children:"HA configurations"})," and record backups regularly.\nFor example, you can use ",(0,r.jsx)(n.code,{children:"pg_dump"})," to create logical backups or set up continuous archiving with write-ahead logs (WAL) for point-in-time recovery.\nTest restoration procedures regularly to ensure your team understands how to execute them in a disaster recovery scenario."]}),"\n",(0,r.jsx)(n.h2,{id:"database-monitoring",children:"Database monitoring"}),"\n",(0,r.jsx)(n.p,{children:"Monitor your PostgreSQL database to ensure optimal performance and reliability:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Use tools like pgAdmin, Prometheus with PostgreSQL exporter, or cloud-based monitoring for PostgreSQL."}),"\n",(0,r.jsx)(n.li,{children:"Track performance metrics such as CPU, memory, and disk I/O usage."}),"\n",(0,r.jsxs)(n.li,{children:["Monitor replica health, availability, lag, and synchronization.\nFor example, use ",(0,r.jsx)(n.code,{children:"pg_stat_activity"})," to monitor connection counts and contention."]}),"\n",(0,r.jsx)(n.li,{children:"Set up alerts and notifications for high latency, failover events, or replication issues."}),"\n",(0,r.jsxs)(n.li,{children:["Enable PostgreSQL logging, such as ",(0,r.jsx)(n.code,{children:"log_connections"})," and ",(0,r.jsx)(n.code,{children:"log_statements"}),", to track access and changes."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"see-also",children:"See also"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/configuration-custom-database",children:"Configure an external PostgreSQL database"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/deployment-architecture",children:"Langbuilder architecture on Kubernetes"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/deployment-kubernetes-prod",children:"Deploy the Langbuilder production environment on Kubernetes"})}),"\n"]})]})}function b(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(m,{...e})}):m(e)}function y(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}}}]);